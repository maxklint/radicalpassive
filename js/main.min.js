"use strict"
function main(){buildGalleries()
initNews()
if(document.body.hasAttribute("is-home"))
initHome()}
function buildGalleries(){document.body.querySelectorAll(".gallery").forEach(function(gallery){new Gallery(gallery)})}
function Gallery(elem){this.collapsed=elem
this.parent=this.collapsed.parentElement
this.expanded=createElement("div","gallery",{"gallery-align":this.collapsed.getAttribute("gallery-fs-align")})
this.parent_fs=createElement("div","fullscreen",{},{"height":window.innerHeight+"px"})
this.parent_fs.appendChild(this.expanded)
this.interactive=elem.hasAttribute("gallery-interactive")
this.header=document.body.querySelector("header")
this.main=document.body.querySelector("main")
this.index=0
this.images=elem.getAttribute("gallery-images").trim().split(",").filter(function(image){return image})
if(!this.images||this.images.length===0)
return
this.fullscreen=false
if(this.collapsed.hasAttribute("gallery-fs"))
this.toggleFullscreen()
if(this.interactive)
this.attachControls()
else
setInterval(this.showNext,5000)
document.body.onresize=this.resize.bind(this)
this.show(0)}
Gallery.prototype.resize=function(index){this.parent_fs.style.height=window.innerHeight+"px"
this.alignControls()}
Gallery.prototype.show=function(index){this.index=index
var src=this.images[index]
var container=this.fullscreen?this.expanded:this.collapsed
var img=container.querySelector(".gallery__image")
if(!img){img=createElement("img","gallery__image")
img.onload=this.alignControls.bind(this)
container.prepend(img)}
img.setAttribute("src",src)
return img}
Gallery.prototype.showNext=function(){this.show((this.index+1)%this.images.length)}
Gallery.prototype.showPrev=function(){this.show(this.index>0?this.index-1:this.images.length-1)}
Gallery.prototype.alignControls=function(){if(this.fullscreen&&this.interactive){var outer=this.expanded.getBoundingClientRect()
var inner=this.expanded.querySelector(".gallery__image").getBoundingClientRect()
this.left.style.left=inner.left-outer.left+"px"
this.right.style.right=outer.right-inner.right+"px"
this.left.style.width=this.right.style.width=Math.floor(inner.width/2)+"px"
this.left.style.height=this.right.style.height=inner.height+"px"}}
Gallery.prototype.attachControls=function(){if(this.images.length>1){this.attachControl(this.collapsed,"gallery__left-arrow","/icons/arrow_left.svg",this.showPrev)
this.attachControl(this.collapsed,"gallery__right-arrow","/icons/arrow_right.svg",this.showNext)
this.left=this.attachControl(this.expanded,"gallery__left-arrow","/icons/arrow_left.svg",this.showPrev)
this.right=this.attachControl(this.expanded,"gallery__right-arrow","/icons/arrow_right.svg",this.showNext)}
this.attachControl(this.collapsed,"gallery__toggle-fs","/icons/plus.svg",this.toggleFullscreen)}
Gallery.prototype.attachControl=function(mount,cls,src,cb){var div=createElement("div","gallery__icon "+cls)
var img=createElement("img","",{"src":src})
cb=cb.bind(this)
div.onclick=function(event){cb()
event.stopPropagation()}
div.appendChild(img)
mount.appendChild(div)
return div}
Gallery.prototype.toggleFullscreen=function(){this.fullscreen=!this.fullscreen
if(this.fullscreen){if(this.interactive){document.body.removeChild(this.header)
document.body.onclick=this.toggleFullscreen.bind(this)}
document.body.removeChild(this.main)
document.body.appendChild(this.parent_fs)}else{document.body.removeChild(this.parent_fs)
if(this.interactive){document.body.appendChild(this.header)
document.body.onclick=null}
document.body.appendChild(this.main)}
this.show(this.index)}
function initHome(){var menu=document.body.querySelector(".menu")
var fullscreen=document.body.querySelector(".fullscreen")
var logo=document.body.querySelector(".logo__link")
var menuDisplay=menu.style.display
menu.style.display="none"
window.onclick=function(){if(menu.style.display==="none"){menu.style.display=menuDisplay
fullscreen.style.display="none"}else{menu.style.display="none"
fullscreen.style.display="block"}}
logo.onclick=function(event){event.preventDefault()}
menu.onclick=function(event){event.stopPropagation()}}
function initNews(){var news=document.body.querySelectorAll(".news__link")
function clickNews(elem){news.forEach(function(link){var parent=link.parentElement
if(link===elem)
toggleClass(parent,"news__listitem_open")
else
parent.classList.remove("news__listitem_open")})}
var preopen=document.body.querySelector("a[href='"+window.location.hash+"']")
if(preopen)clickNews(preopen)
news.forEach(function(target){target.onclick=function(event){clickNews(target)
event.preventDefault()}})}
function toggleClass(elem,cls){var classes=elem.classList
if(classes.contains(cls))
classes.remove(cls)
else
classes.add(cls)}
function createElement(kind,cls,attrs,styles){var elem=document.createElement(kind)
if(cls)
elem.className=cls
for(var key in attrs){if(attrs.hasOwnProperty(key)){var value=attrs[key]
elem.setAttribute(key,value)}}
for(var key in styles){if(styles.hasOwnProperty(key)){var value=styles[key]
elem.style[key]=value}}
return elem}